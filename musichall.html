<html>

<head>
  <title>RattusDong Hub</title>

  <link rel="icon" href="https://raw.githubusercontent.com/RattusDong/rattusdong.com/main/assets/mario%20irl%20transparent.png">

  <link rel="stylesheet" href="styles.css?v=21">
</head>

<body>
  <div>
    <!-- prev song -->
    <p id="left" onclick="indexer(-1)" class="buttonS"> &lt </p>
    <!-- song title -->
    <p id="title" class="title"> </p>
    <!-- next song -->
    <p id="right" onclick="indexer(1)" class="buttonS"> &gt </p>
  </div>

  <!-- playbutton -->
  <p onclick="togglePlay()" id="playpause" class="playpause"> ⏵︎ </p> <br>

  <div>
    <!-- duration as text -->
    <p id="durationText" class="durationText"> </p>
    <!-- scrub bar very cool -->
    <input type="range" id="scrubBar" min="0" value="0" step="0.1" style="width: 80%;">
  </div>
  

  <!-- audio play that actually does the stuff, always hidden -->
  <audio controls id="player" src="" style="display:none;" alt="Audio not found :("> width</audio>

  <br>
  <br>
  <br>
  <img id="rat" src="assets/rat_mouse_PNG23553.png" alt="hot rat" style="width:3.284%;" onclick="ratClick()">

</body>

<script> 
document.addEventListener("DOMContentLoaded", onPageLoad);

//tracks current song
let index = 0;
let ratcount = 0;
let funkyMode = false;

//array for song files
const song = [
"assets/music/The Kingdom of Rattus.mp3",
"assets/music/Rattus Church Good.mp3",
"assets/music/A Wild Rodent Appears.mp3",
"assets/music/Island Of The Green Lake"
];
//array for alt song files
const songAlt = [
"assets/music/The Kingdom of Rattus alt.mp3",
"assets/music/Rattus Church Evil.mp3",
"assets/music/The Wild Rodent Fainted.mp3",
"assets/music/Island Of The Green Lake Music Box"
];

//array for song titles
const songnames = [
"(1) The Kingdom of Rattus", 
"(2) The Holy Church of Rattus",
"(3) A Wild Rodent Appears!",
"(4) The Island On The Green Lake"
];

//array for alt song titles
const songnamesAlt = [
"[①]  una cappella del regno di RATTUS     ",
"[②]  the true church of RATTUS     ",
"[③]  the wild rodent fainted     ",
"[④]  the arcadian island amidst green waters    "
];

//tracks current song full length
let totalMinutes = 0;
let totalSeconds = 0;

//elements
const leftButton = document.getElementById("left");
const rightButton = document.getElementById("right");
const songPlayer = document.getElementById("player");
const songTitle = document.getElementById("title");
const playpause = document.getElementById("playpause");
const durationText = document.getElementById("durationText");
const scrubBar = document.getElementById("scrubBar");
const rat = document.getElementById("rat");

//load page and load song id if in link and funky mode
function onPageLoad() {
  const linkID = getQueryParam("ID");
  if (linkID !== null && !isNaN(linkID) && linkID >= 0 && linkID < song.length) {
    index = parseInt(linkID);
  }
  const funky = getQueryParam("alt");
  if (funky !== null) {
    funkyMode = true;
    funkyTime();
  }
  change();
}

//get parameter in link
function getQueryParam(param) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(param);
}

//change song index
function indexer(num) {
  index += num;
  if (index > song.length - 1) {
    index = 0;
  }
  else if (index < 0) {
    index = song.length - 1;
  }
  change();
}

//change current song to index
function change() {

  if (funkyMode) {
  songTitle.textContent = songnamesAlt[index];
  songPlayer.src = songAlt[index];
  }
  else {
    songTitle.textContent = songnames[index];
    songPlayer.src = song[index];
  }
  playpause.textContent = "⏵︎";
}

//play/pause on click play button
function togglePlay() {
 if (songPlayer.paused || songPlayer.ended) {
   if (songPlayer.ended) {
     songPlayer.currentTime = 0;
    }
    songPlayer.play();
    playpause.textContent = "⏸︎";
  } else {
    songPlayer.pause();
    playpause.textContent = "⏵︎";
  }
}

//when u click the rat
function ratClick() {
  ratcount++;
  rat.style.filter = `hue-rotate(${ratcount * 18}deg)`;
  if (ratcount == 10) {
    funkyMode = true;
    rat.onclick = null;

    funkyTime();

    change();
  }
}

function funkyTime() {
  document.body.style.backgroundImage = "url('assets/Wacky dirty.png')";

leftButton.style.backgroundColor = '#1f2682';
rightButton.style.backgroundColor = '#1f2682';
songTitle.style.backgroundColor = '#1f2682';
playpause.style.backgroundColor = '#1f2682';
durationText.style.backgroundColor = '#1f2682';

leftButton.style.fontFamily = '"Courier New", monospace';
rightButton.style.fontFamily = '"Courier New", monospace';
songTitle.style.fontFamily = '"Courier New", monospace';
playpause.style.fontFamily = '"Courier New", monospace';
durationText.style.fontFamily = '"Courier New", monospace';

}

//update text song duration and scrub
songPlayer.addEventListener("timeupdate", () => {
  const currentTime = songPlayer.currentTime;
  const currentMinutes = Math.floor(currentTime / 60);
  const currentSeconds = Math.floor(currentTime % 60).toString().padStart(2, '0');
  durationText.textContent = `${currentMinutes}:${currentSeconds} / ${totalMinutes}:${totalSeconds}`;
  scrubBar.value = currentTime;
});

//when audio is loaded, set total time variables and reset duration
songPlayer.addEventListener("loadedmetadata", () => {
  const totalDuration = songPlayer.duration;
  totalMinutes = Math.floor(totalDuration / 60);
  totalSeconds = Math.floor(totalDuration % 60).toString().padStart(2, '0');
  durationText.textContent = `0:00 / ${totalMinutes}:${totalSeconds}`;
  scrubBar.max = totalDuration;
});

scrubBar.addEventListener("input", () => {
  songPlayer.currentTime = scrubBar.value;
});

//when song ends
songPlayer.addEventListener("ended", () => {
  playpause.textContent = "⏵︎";
  scrubBar.value = scrubBar.max;
});

</script>

</html>
